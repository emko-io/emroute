# v1.0.0 Release Blockers

Issues that must be resolved before releasing v1.0.0.

---

## 1. `parseAttrsToParams` ignores single-quoted, unquoted, and boolean attributes

**Source:** `issues/issues-1.0.0-beta.5.md` — Issue #11

**File:** `src/util/html.util.ts:158`

The regex `([a-z][a-z0-9-]*)="([^"]*)"` only matches double-quoted
attributes. Single-quoted (`attr='value'`), unquoted (`attr=value`), and
boolean (`disabled`) attributes are silently ignored. This affects
`resolveWidgetTags` in SSR — widget params written with single quotes or
boolean attributes are dropped without warning.

This is inconsistent with how browsers parse HTML. A consumer writing
`<widget-foo name='Alice'>` in their `.page.html` would see params as `{}`
in SSR but `{ name: "Alice" }` in SPA (where the DOM parser handles all
attribute forms).

**Impact:** Silent SSR/SPA data mismatch. Widget behavior differs between
renderers depending on quote style.

**Fix:** Extend the regex to support single quotes, unquoted values, and
boolean attributes.

---

## 2. `resolveWidgetTags` self-closing syntax diverges from HTML spec

**Source:** `issues/issues-1.0.0-beta.5.md` — Issue #12

**File:** `src/util/html.util.ts:101`

The SSR regex matches self-closing custom elements (`<widget-foo />`), but
HTML parsers treat `<widget-foo />` identically to `<widget-foo>` — the `/`
is ignored and the tag remains open. This creates an SSR/SPA mismatch:

- **SSR** (regex): sees `<widget-foo />` as self-closing, resolves it
- **Browser** (DOM): sees `<widget-foo>` as an opening tag, everything
  after becomes children

A consumer writing `<widget-foo name="bar" />` in their `.page.html` gets
correct widget output from SSR but broken layout in SPA, where the rest of
the page becomes children of the unclosed widget element.

**Impact:** Hydration and layout breakage when self-closing syntax is used.

**Fix:** Either stop matching self-closing in SSR (match only paired tags),
or document it clearly and add matching behavior in the SPA hydration path.
Dropping self-closing support is the safer option — it aligns SSR with the
HTML spec.

---

## 3. SPA router intercepts SSR links

**Source:** `issues/spa-intercepts-ssr-links.issue.md`

**File:** `src/renderer/spa/html.renderer.ts` — click handler

When an SSR HTML page (`/html/*`) loads, the SPA JavaScript bundle
initializes and intercepts all internal link clicks — including links to
`/html/*` and `/md/*` paths. Clicking a nav link like `/html/blog` causes
the SPA router to strip the prefix and navigate to `/blog` in SPA mode.

The `/html/` and `/md/` prefixes are a convention signaling SSR rendering
mode (see `issues/cross-mode-links.feature.md` — resolved by convention).
If the link author intended SPA navigation, they would use the bare path.
A link to `/html/blog` explicitly requests a full server-rendered page load.

**Impact:** SSR browsing is broken — clicking any nav link switches to SPA
mode, SSR-rendered widgets disappear, and subsequent navigation bypasses
the server.

**Fix:** Add a guard in the click handler to skip interception when the
href starts with `/html/` or `/md/`.

**Related:** The broader question of context-aware widget links (widgets
adjusting hrefs based on rendering mode) is a design concern tracked in the
same issue file. The design is not final and requires a deep dive into
consequences. The click handler guard is the immediate fix; widget link
awareness is a follow-up.

---

## 4. SSR markdown emits useless `router-slot` placeholder for leaf pages

**Source:** `issues/md-router-slot-placeholder.issue.md`

When rendering an HTML-only page (e.g., `about.page.html`) through the
SSR Markdown renderer, `PageComponent.renderMarkdown()` falls back to the
`` ```router-slot``` `` placeholder because there is no `.md` file. For
leaf pages with no children, this placeholder is never replaced and appears
in the output as a literal fenced code block.

The HTML renderer doesn't have this problem — `<router-slot></router-slot>`
is naturally invisible in the browser or gets replaced by child content.

**Impact:** Markdown consumers (LLMs, text clients, API integrations) see
meaningless `` ```router-slot``` `` blocks in responses for HTML-only pages.

**Fix:** After composing the full markdown hierarchy, strip any remaining
`` ```router-slot``` `` blocks that were never substituted.
